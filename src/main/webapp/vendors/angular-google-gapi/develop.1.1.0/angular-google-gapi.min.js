/**
 * An AngularJS module for use all Google Apis and your Google Cloud Endpoints
 * @version 1.1.0
 * @link https://github.com/maximepvrt/angular-google-gapi
 */
!function(){"use strict";angular.module("angular-google-gapi",[])}(),function(){"use strict";angular.module("angular-google-gapi").factory("GApi",["$q","GClient","GAuth","$window",function(e,n,t,o){function i(e,n,t,o,i){var r={};r.api=e,r.apiLoad=!1,r.method=n,r.params=t,r.auth=o,r.deferred=i,f.push(r)}function r(t,i,r){var u=e.defer();return n.get().then(function(){o.gapi.client.load(t,i,void 0,r).then(function(e){var n={api:t,version:i,url:r};e&&e.hasOwnProperty("error")?(console.log("impossible to load "+t+" "+i),u.reject(n)):(u.resolve(n),s.push(t),a(t))})}),u.promise}function a(e){for(var n=e,o=0;o<f.length;o++){var i=f[o];i.api!=n&&!i.apiLoad||0!=i.auth&&!t.isLogin()?i.api==n&&(f[o].apiLoad=!0):(l(i.api,i.method,i.params,i.deferred),o>-1&&f.splice(o--,1))}}function u(e,n,t){for(var i=n.split("."),e=o.gapi.client[e],r=0;r<i.length;r++)e=e[i[r]];return e(t)}function l(e,n,t,o){u(e,n,t).execute(function(e){e.error?o.reject(e):o.resolve(e)})}function c(n,t,o,r){var a=e.defer();return s.indexOf(n)>-1?l(n,t,o,a):i(n,t,o,r,a),a.promise}function g(n,t){function o(e,n){e.apply(this,t).then(function(e){i.resolve(e)})["catch"](function(t){if(403==t.code&&t.message.toLowerCase().indexOf("limit exceeded")>-1||503==t.code){var r=2,a=1e3,u=Math.floor(1e3*Math.random()+1);n<5?setTimeout(function(){o(e,++n)},a*Math.pow(r,n)+u):i.reject(t)}else i.reject(t)})}var i=e.defer(),r=0;return o(n,r),i.promise}var s=[],f=[],d=!0;return{executeCallbacks:function(){a()},load:r,createRequest:u,execute:function(e,n,t){return 3==arguments.length?c(e,n,t,!1):2==arguments.length?c(e,n,null,!1):void 0},executeAuth:function(e,n,o){return d&&(console.log("test"),t.signInListener(),d=!1),3==arguments.length?g(c,arguments):2==arguments.length?g(c,arguments):void 0}}}])}(),function(){"use strict";angular.module("angular-google-gapi").factory("GAuth",["$rootScope","$q","GClient","$interval","$window",function(e,n,t,o,i){function r(){var e=n.defer();return 0==f?d?(console.log("o"),m.push(e)):(d=!0,t.get().then(function(){i.gapi.load("auth2",function(){f=!0,d=!1,e.resolve();for(var n=0;n<m.length;n++)m[n].resolve(),console.log("o2")})})):e.resolve(),e.promise}function a(){var e=n.defer();return console.log("i"),p?(console.log("ok "+t.getClient()),e.resolve(i.gapi.auth2)):h?(console.log("wait"),w.push(e)):(h=!0,r().then(function(){console.log(t.getClient());var n={client_id:t.getClient(),scope:t.getScope()};void 0!=t.getDomain()&&(n.hosted_domain=t.getDomain()),i.gapi.auth2.init(n).then(function(){console.log("o"),e.resolve(i.gapi.auth2),h=!1,p=!0;for(var n=0;n<w.length;n++)w[n].resolve(i.gapi.auth2),console.log("back "+t.getClient())},function(){e.reject(),h=!1,p=!1;for(var n=0;n<w.length;n++)w[n].reject()})})),e.promise}function u(){console.log("grr");var e=n.defer();return a().then(function(n){console.log(n),e.resolve(n.getAuthInstance())}),e.promise}function l(){u().then(function(e){e.signIn()})}function c(){var e=n.defer();return u().then(function(n){if(n.code)e.reject();else{var t=n.currentUser.get().getBasicProfile(),o={email:t.getEmail(),id:t.getId(),given_name:t.getGivenName(),family_name:t.getFamilyName(),picture:t.getImageUrl(),name:t.getName()};e.resolve(o)}}),e.promise}function g(){return v}function s(){console.log("ooooo")}var f=!1,d=!1,p=!1,h=!1,v=!1,m=[],w=[];return{isLogin:g,signInListener:s,getUser:c,signIn:l,init:a}}])}(),function(){"use strict";angular.module("angular-google-gapi").factory("GClient",["$document","$q","$window","$timeout",function(e,n,t,o){function i(i){var r=n.defer();t._gapiOnLoad=function(){r.resolve()};var a=e[0].createElement("script");return a.onerror=function(e){o(function(){r.reject(e)})},a.src=i,e[0].body.appendChild(a),r.promise}function r(){var e=n.defer();return u?e.resolve():l?g.push(e):(l=!0,i(c).then(function(){u=!0,l=!1,e.resolve();for(var n=0;n<g.length;n++)g[n].resolve()})),e.promise}var a,u=!1,l=!1,c="https://apis.google.com/js/client:platform.js?onload=_gapiOnLoad",g=[],s=void 0,f=["https://www.googleapis.com/auth/userinfo.email"];return{get:r,setClient:function(e){a=e},getClient:function(){return a},setDomain:function(e){s=e},getDomain:function(){return s},setScope:function(e){f=e},getScope:function(){return f}}}])}(),function(){"use strict";angular.module("angular-google-gapi").directive("googleSignIn",["$window","GAuth",function(e,n){return{restrict:"E",template:'<div id="g-signin2"></div>',replace:!1,link:function(t,o,i){n.init().then(function(){e.gapi.signin2.render("g-signin2",{width:i.width||250,height:i.height||50,longtitle:"false"!==i.longtitle,theme:i.theme||"light"})})}}}])}();